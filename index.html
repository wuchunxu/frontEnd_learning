<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
	<title>wuchunxu的前端笔记</title>
	<link rel="stylesheet" href="css/base.css">
	<link rel="stylesheet" href="css/main.css">
</head>
<body>
	
	<nav>
        <div class="logo">前端学习笔记</div>
        <ul class="navi-menu">
            <li>
                <p>联系我</p>
                <div class="detail">
                    <p>wcxcapricorn@foxmail.com</p>
                </div>
            </li>
        </ul>
	</nav>
	<div class="header-filter"></div>

	<main>
		 <div class="content"></div>
	</main>
	<div id="shower"></div>
	<div id="layer"></div>
	<script src="js/util.js"></script>
	<script>
        var getResource = null;//定义全局，供其他地方使用
        (function () {
            //获取页面内容载体、弹窗和遮罩层
            var content = document.getElementsByClassName("content")[0],
                shower  = document.getElementById("shower"),
                layer   = document.getElementById("layer");
            /*
                初始化页面数据
            */
            var pageData = {
                "熟悉服务端": ["软件工程", "服务器和数据库", "PHP"],
                "初入前端": ["HTML(未更新)", "JS基础", "Ajax", "CSS", "CSS3"],
                "JS高级": ["JS内置类型", "Function", "面向对象", "ES5", "ES6","DOM", "BOM","jQuery"],
                "HTML、CSS、JS进阶":["HTML5","Bootstrap","Node.js"]
            }
            
            function showModal(){
                shower.style.display = "block";
                layer.style.display = "block";
            }
            function hideModal(){
                shower.style.display = "none";
                layer.style.display = "none";
            }
            Element.prototype.is = function (tagName){
                return this.tagName.toUpperCase() === tagName.toUpperCase();
            }
            getResource = function (url) {
                ajax(url, {
                    success: function (data) {
                        //请求成功后，显示弹窗和遮罩层
                        shower.innerHTML = data;
                        showModal();
                        var menu = shower.getElementsByClassName("menu")[0];
                        //给弹窗中ul设置点击事件
                        menu.addEventListener("click",function(e){
                            var tar = e.target;
                            var lis = menu.querySelectorAll(".menu>li");
                            
                            if( tar.is("p") && tar.parentNode.is("li") ){
                                var cur_li = tar.parentNode;
                                //记录当前li的激活状态
                                var is_active = cur_li.hasClass("active");
                                //将所有的li去除激活状态
                                [].forEach.call(lis,ele=>ele.removeClass("active"));
                                //如果当前li没有激活，则设置为active
                                if(!is_active) cur_li.addClass("active");
                            }
                        });
                    }
                });
            }
            /*
                监听在shower的点击事件上，如果点击返回，则隐藏模态弹窗
            */
            shower.onclick = function(e){
                e.preventDefault();
                if(e.target.hasClass("back")) hideModal();
            }
            /*
                点击遮罩层，隐藏弹窗
            */
            layer.onclick = hideModal;
            /*
                监听页面加载的内容，如果是item，则加载资源
            */
           content.onclick = function(e){
                var tar = e.target;
                if(tar.hasClass("click-layer")){
                    var url = `resource/${tar.dataset.title}.html`;
                    getResource(url);
                }
           }

            function loadPage(data){
                var html = "";
                var i = 1;
                for(var prop in data){
                    html += `<section><h2><div class="line"></div><span class="title">阶段${i}:${prop}</span></h2>`;
                    html += `<div class="clear">`;
                    for(var ele of data[prop]){
                        html += `<div class="item">
                                    <p><img src="images/icon/${ele}.png"></p>
                                        <p>${ele}</p>
                                        <div class="click-layer" data-title="${ele}"></div>
                                    </div>`;
                    }
                    html += `</section>`;
                    i++;
                }
                content.innerHTML = html;
            }
            loadPage(pageData);
            
        })();

        var li = document.querySelector(".navi-menu>li");
        li.onmouseover = function(e){
            this.children[1].addClass("in");
        }
        li.onmouseout = function(e){
            this.children[1].removeClass("in");
        }
    </script>
</body>
</html>