<h2>Ajax</h2>
<button class="back">返回</button>
<ul class="menu">
	<li>
		<p>HTTP协议</p>
		<div class="desc">
			<h2>HTTP协议</h2>
			<h3>什么是HTTP协议</h3>
			<p><strong>HTTP协议规定使用URI来传输数据和建立连接，并规定了请求消息和响应消息的具体格式。遵循HTTP协议，可以实现“超文本内容”在服务端和客户端之间的传输。</strong>比如，传输HTML、CSS、JS、图片、音频等。</p>
			<p>另外，请了解：HTTP协议属于TCP/IP协议家族中
				<em>应用层协议</em>。(TCP/IP知识暂时挂起)</p>
			<table>
				<tr>
					<td>应用层</td>
					<td>HTTP、HTTPS、FTP、SSH、DNS...</td>
				</tr>
				<tr>
					<td>传输层</td>
					<td>TCP、UDP</td>
				</tr>
				<tr>
					<td>网络层</td>
					<td>IP、ICMP、IGMP</td>
				</tr>
				<tr>
					<td>网络接口层</td>
					<td>以太网、令牌环、光线数据交换接口</td>
				</tr>
			</table>
			<p><strong>HTTP协议的工作模式：</strong>HTTP协议是典型的基于“
				<em>请求-响应</em>”模型的协议，只有客户端发出请求，服务器才会响应，且一个请求一个响应。</p>
			<h3>HTTP协议的版本</h3>
			<p>HTTP协议目前有3个版本：HTTP/1.0(1996年发布)、HTTP/1.1(1999年发布)、HTTP/2(2015年发布)</p>
			<table>
				<tr>
					<th>版本</th>
					<th>特性</th>
				</tr>
				<tr>
					<td>HTTP/1.1</td>
					<td>
						<p>支持虚拟主机，持久连接，代理连接</p>
					</td>
				</tr>
				<tr>
					<td>HTTP/2</td>
					<td>
						<p>二级制协议、多路复用流、优先权和依赖、头部压缩、请求重置、服务器推送、流量控制</p>
					</td>
				</tr>
			</table>
			<h3>HTTP协议对传输数据格式的规定</h3>
			<h4>请求起始行</h4>
			<pre class="code"><span class="note">//请求方式 请求地址 协议版本</span>
GET /script/images_new/icon1_unity.png HTTP/1.1</pre>
			<h5>请求方式</h5>
			<table>
				<tr>
					<td>GET</td>
					<td>获取服务器数据</td>
				</tr>
				<tr>
					<td>POST</td>
					<td>向服务器发送数据</td>
				</tr>
				<tr>
					<td>PUT</td>
					<td>向服务器上传文件</td>
				</tr>
				<tr>
					<td>DELETE</td>
					<td>删除服务器上指定资源</td>
				</tr>
				<tr>
					<td>HEAD</td>
					<td><p>获取服务器上的数据，不要内容，只要响应头信息</p></td>
				</tr>
				<tr>
					<td>TRACE</td>
					<td>追踪</td>
				</tr>
				<tr>
					<td>CONNECT</td>
					<td>连接</td>
				</tr>
				<tr>
					<td>OPTION</td>
					<td>备选</td>
				</tr>
			</table>
			<h5>GET和POST区别</h5>
			<table>
				<tr>
					<td rowspan="2">发送数据大小</td>
					<td>GET</td>
					<td>1KB</td>
				</tr>
				<tr>
					<td>POST</td>
					<td>无限制</td>
				</tr>
				<tr>
					<td rowspan="2">语义</td>
					<td>GET</td>
					<td>获取数据</td>
				</tr>
				<tr>
					<td>POST</td>
					<td>发送数据</td>
				</tr>
				<tr>
					<td rowspan="2">请求主体</td>
					<td>GET</td>
					<td>无请求主体</td>
				</tr>
				<tr>
					<td>POST</td>
					<td>有请求主体</td>
				</tr>
				<tr>
					<td>安全性</td>
					<td colspan="2">GET/POST都不安全</td>
				</tr>
			</table>
			<h5>发送GET/POST请求的方式</h5>
			<table>
				<tr>
					<td rowspan="6">发送 GET请求</td>
					<td>地址栏输入url 回车</td>
				</tr>
				<tr>
					<td>form method="GET"</td>
				</tr>
				<tr><td>AJAX GET</td></tr>
				<tr><td>&lt;a href="1.php">...&lt;/a></td></tr>
				<tr><td>&lt;img src="1.php"></td></tr>
				<tr><td>&lt;script src="1.php"></td></tr>
				<tr>
					<td rowspan="2">发送 POST请求</td>
					<td>ajax post</td>
				</tr>
				<tr>
					<td>form method="post"</td>
				</tr>
			</table>
			<h4>请求头</h4>
<pre class="code">Host: tmooc.cn <span class="note">//请求主机</span>
Connection: keep-alive <span class="note">//请求启用持久连接</span>
Pragma <span class="note">//HTTP1.0 启动浏览器缓存</span>
Cache-Control <span class="note">//缓存</span>
User-Agent <span class="note">//客户端信息</span>
Referer: http://tmooc.cn/ <span class="note">//发起请求源地址</span>
Accept: text/html,application/xhtml+xml,application/xml;q=0.9, <span class="note">//可接受数据格式</span>
Accept-Language: zh-CN,zh;q=0.9 <span class="note">//接收的自然语言</span>
Cookie: _pk_id.3.d0e4=bf45f6a95d1405e9 <span class="note">//发起请求时携带的cookie</span>
Content-Length: <span class="note">//请求主体长度</span>
Content-Type: <span class="note">//请求主体类型</span></pre>
			<h4>请求数据格式</h4>
			<table>
				<tr>
					<td>1xx提示性信息</td>
					<td>
						<p>100 Continue</p>
						<p>101 Switching protocol http/https切换</p>
					</td>
				</tr>
				<tr>
					<td>2xx 成功响应</td>
					<td>
						<p>200 OK正确响应</p>
						<p>201 Created创建成功(PUT)</p>
					</td>
				</tr>
				<tr>
					<td>3xx 重定向</td>
					<td>
						<p>301 Moved Permanently，资源永久移动</p>
						<p>303 See Other</p>
						<p>302 重定向</p>
						<p>304 Not Modified，命中缓存</p>
					</td>
				</tr>
				<tr>
					<td>4xx</td>
					<td>
						<p>400：Bad Request</p>
						<p>403：Forbidden 访问被拒绝（权限）</p>
						<p>404：Not Found </p>
						<p>405: Method Not Allowed</p>
					</td>
				</tr>
				<tr>
					<td>5xx</td>
					<td>
						<p>500：Interval Server Error服务器内部出错</p>
						<p>501：Not Implemented 没有实现</p>
						<p>503：Service Unavaliable </p>
					</td>
				</tr>
			</table>
			<p>虚拟主机：一台服务器上同时支持多个主机(host)，比如一台服务器跑了好几个网站。通过Apache可以配置虚拟主机。</p>
			<p>持久化连接：在网络请求中，如果出现
				<em>多次请求，中间不断开连接</em>。这样避免每次请求数据都要“
				<em>3次握手和4次挥手</em>”。</p>
			
			<h4>HTTP协议规范了数据如何被打包和传输。</h4>
			<p>URI：Uniform Resource Identifiers，统一资源标识符</p>
			<p>URL：Uniform Resource Locator，统一资源定位符</p>
			
			<h5>Content-Type(响应主体类型)</h5>
			<table>
				<tr>
					<td>text/plain</td>
					<td>纯文本</td>
				</tr>
				<tr>
					<td>text/html</td>
					<td>超文本</td>
				</tr>
				<tr>
					<td>text/css</td>
					<td>css</td>
				</tr>
				<tr>
					<td>application/json</td>
					<td>json</td>
				</tr>
				<tr>
					<td>application/javascript</td>
					<td>javascript</td>
				</tr>
			</table>
		</div>
	</li>
	<li>
		<p>AJAX</p>
		<div class="desc">
			<h2>Ajax</h2>
			<h3>什么是Ajax</h3>
			<p>Ajax(Asynchronous javascript And XML)，即异步的js和xml，重点在于异步。</p>
			<h3>参与工作的对象、属性、方法和事件</h3>
			<h4>XMLHttpRequest对象</h4>
			<p>用于发起异步请求，并接受返回数据</p>
			<pre class="code">var xhr = XMLHttpRequest? new XMLHttpRequest : new ActiveXObject("Microsoft.XML");</pre>
			<h4>属性</h4>
			<table>
				<tr>
					<td>readState</td>
					<td>
						<p>0,消息未发送</p>
						<p>1,Opened，xhr打开到服务器的连接</p>
						<p>2,</p>
						<p></p>
					</td>
				</tr>
			</table>
		</div>
	</li>
    <li>
        <p>Ajax函数的封装</p>
        <div class="desc">
            <h2>Ajax函数的封装</h2>
			<h3>封装功能强大的ajax函数</h3>
            <pre class="code"><span class="note">//特性一：对象传参，屏蔽了参数顺序对结果的影响；</span>
function ajax({url,method,data,dataType}){
	<span class="note">//封装了函数，用以将data对象的数据拼接成字符串</span>
	var makeQueryString = function(data){
		var queryStr = "";
		var arr = [];
		for(var prop in data){
				arr.push(`${encodeURIComponent(prop)}=${encodeURIComponent(data[prop])}`);<span class="note">//防止中文乱码</span>
		}
		queryStr = arr.join("&");
		return queryStr;
	}

	var resolve = function(callback){
		//将参数对象拼接成查询字符串
		var queryStr = "";
		if(data) queryStr = makeQueryString(data);
		//创建xhr对象
		var xhr = XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHttp");
		//绑定事件
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				if(dataType && dataType.toUpperCase()=="JSON"){
					callback(JSON.parse(xhr.responseText));
				}else{
					callback(xhr.responseText);
				}
			}
		}
		<span class="note">//open和send的选择</span>
		if(method && method.toUpperCase() === "POST"){
			<span class="note">//post方法</span>
			url += "?timestamp=" + new Date().getTime();
			xhr.open("post",url,true);
			xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			xhr.send(queryStr);
		}else{
			<span class="note">//get方法</span>
			if(queryStr!=""){
				url = url+"?"+queryStr;
				url += "&timestamp="+new Date().getTime();
			}
			xhr.open("get",url,true);
			xhr.send(null);
		}
	}
	<span class="note">//返回Promise对象</span>
	return new Promise(resolve);
}</pre>
        </div>
	</li>
	<li>
		<p>ajax请求错误记录</p>
		<div class="desc">
			<h2>ajax请求错误记录</h2>
			<h3>ajax请求错误</h3>
			<h4>用ajax请求php文件时，期望返回json，实际返回的是php文件</h4>
			<p>原因1：端口不同，造成跨域。webstorm快捷打开用的服务器不一样</p>
		</div>
	</li>
	<li>
		<p>跨域</p>
		<div class="desc">
			<h2>跨域</h2>
			<h3>跨域参见jQuery笔记部分</h3>
		</div>
	</li>
</ul>